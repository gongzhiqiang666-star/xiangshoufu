
20260124会议记录
# 增加手动调账功能在PC端
    出现没有协议，没法自动计算等情况，需要后台人工计算金额后将钱充入选择的钱包，钱包流水里记录详细的调账记录，PC端也可以查询钱包流水记录。


# 终端入库操作
选择所属通道、终端类型（需要维护）、结算价设置、号段区间，最后让操作员确认要入库的详细信息和数量，确认无误入库成功
号段区间：我们会拿回一整箱的机具，箱子上回写着一批机具SN的开始和结束区间。例如001到005，这就是5台机具，我们要将这5台机具入库。
服务费金额不是在政策模版里么？ 怎么还单独维护？ 
对应通道的终端类型需要维护字典
Excel导入最后做，留口子，模版还没固定下来，标注TODO。

# 政策模版
    a.成本部分按通道重新调整
    每家通道的成本配置是不同的，换个意思是费率类型不同，费率范围不同，例如联动这个厂商的费率类型参考【docs/api/联动接口文档.md】中关于费率类型的说明，这块涉及成本的维护方式，成本的维护按通道的配置走，分润的计算也要按作对应调整，还没想好怎么实现，初步想的是没法做通用的配置，因为通道方可能会调整，我们架构要能做到动态调整，因为回调数据里的费率类型肯定是自己通道的编码，这个要和成本维护中的费率类型能够对得上。

    b.因为每家通道的接口文档不同，拿到数据不同，跑批时的政策模版也要和接口文档联动。这块看下如何实现，是不是考虑可以将不同通道的配置维护成JSON，存下来，后续跑批的时候能够动态读取和操作。
    跑批概念：基于通道回传的交易流水和给代理商的结算价，计算分润、返现的操作

    c.奖励与通道没关系，政策模版中单独维护，不放入某个通道下。
    d.奖励逻辑调整
        第一维度：按阶段 
            a.几阶段 
            b.按终端绑定时间为主
            c.按天数（1-10天、10到20天等）、按自然月（当月、次月开始跑）；
                注意：终端绑定时间回传就开始计算奖励，就算1天，从绑定开始的0点算到结束当天的23:59:59

        第二维度：按维度  
            a.金额 
                aa1.按交易类型（扫码、借记卡、贷记卡）
                
            b.笔数 
                bb1: 交易金额够10笔奖励10元
                bb2: 交易金额再交易够10笔再奖励20元
                bb3: 按交易金额分阶段配置奖励
                bb4: 交易金额有限制，例如大于等于0元、小于200元能够参加
        
        按阶段+按维护共同构成奖励标准，但只可以维护一个维度。
        奖励的金额能不能提现，和充值钱包有关系。
        公共设置：断档给不给奖励要加个开关，实时生效，这块测试时要注意，生效前后的对比；
            比如说第一阶段达标了我们给奖励；第二个阶段没达标能不能奖励。
        奖励是按阶段发放的，到了阶段计算奖励，发放到奖励钱包并记录奖励原因。
        上下级倒挂的说法是错误的，奖励是按资金池分配奖励金额的，那么该代理商链上的奖励总金额不能大于奖励金额，要在调整奖励活动时判断，以及计算奖励时进行验证。   

    
    f.高调部分在交易里体现、高调部分也要正常分润、独立于正常交易，高调部分的政策模版也要增加维护，这块应该是和费率类型联动的，放到政策模版里单独维护。
    接口文档里要能够区分高调部分，这个在接口对接过程中要注意。


    f.现在政策模版中的【费率阶梯配置（代理商调价）】应该就是成本配置的内容，分阶段设置费率，到期自动调整费率，这块涉及核心分润计算逻辑要重新设计和实现。
    如果是给的固定费率， 那么就是无限期固定费率，如果是分阶段的，从终端激活时间开始计算，费率多少，下一个阶段费率是多少，但切记不能超过通道的封顶费率。
    到时间，修改下级代理商的成本，注意这里不再调用通道接口，因为代理商调价是我们的内部行为，和通道没有关系
    代理商调价设置要注意不能小于下级代理商，否则利润穿透，代理商要亏本。
    实时生效。

    

    总结：代理商调价
        按终端激活时间 + 分阶段 + 按费率类型 设置费率 ---> 形成结算价
        后台按约定的时间维度，定时触发，调整代理商的结算价（这里只涉及成本费率），同时记录调价历史。
        消息提醒（只能管理员收到提醒，默认不提醒代理商）


    g. 押金是199还是299还是99，这块每家通道不同，做成可维护。
    
    i.成本费率里的P+0 ，配置加1、加2、加3 ，这个钱也要按照级差分润，这块政策模版里要配置，配置一个固定的金额就好，但注意级差，例如上级这块设置是1块，那下级设置只能在0到1之间设置。不然没级差，没法计算分润。（待完善，暂不实现）

# 结算价
    在实际运行中政策模版是一套标准，代理商注册后，上级代理商分配自己的政策模版新成结算价，但代理商可以基于这套模版调整自己的结算价，更新结算价表
    政策模版是一张表，给代理商分配政策模版后，数据写入结算价表，下级代理商有了结算价，可以展业了。
    结算价表应该是代理商计算分润来源，并且每调一次价，记录一次调价。
    计算分润、返现和奖励要走最新的结算价表，是用的结算价计算分润的。
    调价是很严肃的问题，一定要留有记录、PC端和APP端可以查询
    这是最新的政策模版和结算价的说明。

# 钱包逻辑调整
    钱包默认按钱包类型展示，默认不拆通道。
    但是我们可以控制该代理商是否按通道拆分，提现门槛也要做对应维护，这个要做单独功能维护，只有管理员能够控制，代理商看不到。
    按通道拆分的话，那提现也要按通道提现，通道越多，手续费越多。
    而且按通道拆分的话，那钱包会有二级钱包，二级钱包就是对应通道的钱包。提现按钮点击后跳到二级钱包上进行提现。
    注意提现这个动作本身不依赖通道，达到提现门槛后，走代充通道直接提现给代理商。
    提现门槛也要在政策模版中维护。
    冻结金额的逻辑核实现在有没有？

# 终端管理
    APP端操作：
    机具分状态：已出库、已绑定、已激活、未出库、未绑定、未激活几个状态。
    按机具类型汇总显示机具库存情况：分已出库、已绑定、已激活、未出库、未绑定、未激活。
    汇总下提供操作：终端回拨、终端下发、默认费率修改、终端绑定、流动记录
    注意：终端里操作的是未激活的机具
    例如默认费率修改点进去显示机具列表，多选，然后选择结算价，保存提交，机具结算价调用接口告知通道方，设置完成。
    

# 商户管理
    
    
    详情（根据接口）：
    显示商户详情、结算价、交易分析
    给出例子：脱敏手机号、机具编号、激活时间、首次流量费时间、首次流量费金额、刷卡费率、扫码费率、交易额统计（累计、本月总额、本月贷记卡、本月借记卡、本月微信、本月支付宝）
    
    要求：商户姓名、商户编号、机具编号可以互查
    注意：商户信息除了姓名，其他涉及个人信息部分全部脱敏存储，如果是代理商新增商户，那该手机号只向该代理商展示。

    分直营商户和团队商户：商户类型、基本信息、机具信息（终端激活时间等）、费率信息、交易分析。
    
    商户类型分类逻辑调整，统计:
        1.优质
        月均交易≥5万
        2.中等
        3万≤月均交易＜5万
        3.普通
        月均交易＜3万
        4.预警商户
        30天无交易
        5.流失商户
        60天无交易
    支持结算价调整，当然调整的是终端的费率，其实调整的是已经激活的机具。


# 代扣管理
    代扣管理和货款代扣合并后叫代扣管理。
    货款代扣合并到上级代扣功能中。
    代扣协议还未提供
    代扣定时扣除，不再实时扣除
    定时扣除的话，钱包里要做冻结金额，冻结部分就是代扣部分。
    所以计算分润和返现后不再实时触发货款代扣逻辑，等待后续的定时扣除。

                                          
  