# 联动支付 - 展业模式接口文档 V1.0.1

> 文档来源：联动-展业模式接口文档V1.0.1.docx
> 最后更新：2025-12-10

---

## 1. 对接说明

### 1.1 基本信息

| 项目 | 说明 |
|------|------|
| 请求方式 | POST |
| 参数格式 | JSON |
| 字符编码 | UTF-8 |
| 通知响应 | 合作伙伴需返回：`OK` |

### 1.2 符号约定

| 符号 | 请求方约束 | 服务方约束 |
|------|-----------|-----------|
| M | 必须包含该域 | 必须校验该域合法性约束 |
| C | 如果条件符合必须包含该域 | 当条件满足时，必须校验该域是否存在 |
| O | 该域可选 | 当该域存在时，必须检查其内容的合法性 |

### 1.3 通用请求参数

| 参数名 | 参数类型 | 参数说明 |
|--------|---------|---------|
| appId | String | 代理商编号 |
| encryptKey | String | 加密后的AES KEY |
| timestamp | String | 时间戳(毫秒)，示例: 1694420927678 |
| requestId | String | 请求流水号 |
| sign | String | 签名 |

### 1.4 通用响应参数

| 参数名 | 参数类型 | 参数说明 |
|--------|---------|---------|
| appId | String | 代理商编号 |
| encryptKey | String | 加密后的AES KEY (code返回00后有数据) |
| sign | String | 签名 (code返回00后有值) |
| timestamp | String | 时间戳(毫秒) |
| responseId | String | 响应流水号 |

### 1.5 平台请求地址

| 环境 | 地址 |
|------|------|
| 测试环境-商户类 | https://cloud-api-dev.li-pos.cn/merchant |
| 测试环境-代付类 | https://cloud-api-dev.li-pos.cn/payment |

---

## 2. 加解密算法

### 2.1 算法说明

| 算法类型 | 说明 |
|---------|------|
| RSA非对称加密 | 密钥size为2048，RSA/ECB/PKCS1Padding |
| AES对称加密 | 填充模式: PKCS5Padding，Mode.ECB |
| 签名算法 | SHA256WithRSA |

### 2.2 加密规则

1. 生成16位随机密钥 `aeskey`
2. 用 `aeskey` 对数据用AES算法进行加密（对应字段 `data`）
3. 用平台公钥对 `aeskey` 用RSA算法加密（对应字段 `encryptKey`）
4. 把报文数据字段名称按字典升序排序，拼接成字符串，对接方用私钥使用RSA算法加密拼接后的字符串生成签名（对应 `sign` 字段）

### 2.3 解密规则

1. 先验证签名：用接收到报文排除签名sign，按字典升序排序，拼接成字符串，用平台提供的公钥使用RSA算法验签
2. 对接方需要用私钥解密出 `encryptKey`，为AES加密key
3. 用AES加密key，解密 `data` 数据

### 2.4 Java代码示例

```java
// RSA解密
public static String decryptByApi(String data, String encryptKey, String privateKey) {
    String decryptRandomKey = null;
    try {
        RSA rsa = new RSA(StrUtil.cleanBlank(privateKey), null);
        decryptRandomKey = rsa.decryptStr(encryptKey, KeyType.PrivateKey);
    } catch (Exception e) {
        throw new RuntimeException("解密失败");
    }
    String decryptData = AesUtil.decryptFromBase64(decryptRandomKey, data);
    return decryptData;
}

// AES加密
public static String encryptToBase64(String key, String content) {
    AES aes = new AES(Mode.ECB, Padding.PKCS5Padding, key.getBytes(StandardCharsets.UTF_8));
    return aes.encryptBase64(content);
}

// 签名
public static String sign(String content, String privateKey) {
    try {
        PrivateKey priKey = SignUtil.getPrivateKey(privateKey);
        Signature signature = Signature.getInstance("SHA256WithRSA");
        signature.initSign(priKey);
        signature.update(content.getBytes("UTF-8"));
        byte[] signed = signature.sign();
        return Base64Encoder.encode(signed);
    } catch (Exception e) {
        log.error("sign(...) 异常：", e);
    }
    return null;
}
```

---

## 3. 通知类接口（回调）

> **重要**：通知接收后，合作伙伴需要返回值为：`OK`

### 3.1 通知公共参数

| 参数名称 | 参数类型 | 参数说明 |
|---------|---------|---------|
| appId | String | 代理商编号 |
| data | String | 加密数据 |
| encryptKey | String | 加密密钥 |
| serviceType | String | 通知类型 |
| sign | String | 签名 |
| timestamp | String | 时间戳 |
| responseId | String | 响应流水号 |

### 3.2 交易订单通知 (PAY_ORDER_NOTIFY)

**serviceType**: `PAY_ORDER_NOTIFY`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 代理商编号 | agentNo | String | M | |
| 商户名称 | customerName | String | M | |
| 商户编号 | customerNo | String | M | |
| 设备tusn | materialsNo | String | M | |
| 订单类型 | transType | String | M | TRADE 交易 |
| 支付类型 | productTypeCode | String | M | 参考字典：3.9 支付类型 |
| 支付类型明细 | payTypeCode | String | M | 参考字典：3.10 支付类型明细 |
| 订单编号 | orderNo | String | M | |
| 订单金额 | amount | BigDecimal | M | 单位:元 保留小数点两位 |
| 结算金额 | settleAmount | BigDecimal | M | 单位:元 保留小数点两位 |
| 费率版本号 | rateVersion | String | M | 修改费率时返回的费率版本号 |
| 费率(基础) | feeRate | BigDecimal | M | 百分比类型; 示例: 0.3% 值为0.3 |
| 是否封顶 | isCapping | String | M | YES 封顶 NO 未封顶 |
| 手续费计算规则 | feeCalculationRules | String | M | A\B\C\D\E 具体规则 |
| 手续费(基础) | fee | BigDecimal | M | 单位:元 保留小数点两位 |
| 笔数费(基础) | fixedValue | BigDecimal | M | 单位:元 保留小数点两位 |
| 平台服务费信息 | serviceFeeList | List | O | 具体信息: 平台服务费信息 |
| 订单状态 | status | String | M | 参考字典: 3.11 订单状态 |
| 订单成功时间 | successTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 卡类型 | cardType | String | O | 类型: DC 借记卡 CC 贷记卡 |
| 交易卡号 | cardCode | String | O | 脱敏格式 示例:6200***********8888 |
| 交易卡银行编码 | bankCode | String | O | |
| 止付订单编号 | stopOrderNo | String | O | |
| 止付类型 | stopPayType | String | O | 参考字典：3.7 止付类型 |
| 止付金额 | stopPayAmount | BigDecimal | O | 单位:元 保留小数点两位 |
| 止付阶段 | stopRuleIndex | Integer | O | MACHINE:固定为1; SIM:按阶段返回 |
| 止付档位 | stopPhaseIndex | Integer | O | MACHINE:固定为1; SIM:按档位返回 |

#### 平台服务费信息

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 平台服务费 | serviceFee | BigDecimal | O | |
| 业务类型 | businessType | String | M | |

#### 计费规则说明

| 计费规则 | 卡类型 | 计算方式 | 说明 |
|---------|-------|---------|------|
| 规则A | 借记卡/贷记卡 | 进位 | 100.11 * 0.0061 = 0.610671，进位后0.62元 |
| 规则A | 银联二维码/微信/支付宝 | 进位 | 取对应费率，进位方式同借记卡 |
| 规则B | 借记卡 | 折扣+去尾+进位 | 费率9折，分后第三位去尾，分后一二位进位 |
| 规则B | 贷记卡/银联/微信/支付宝 | 去尾+进位 | 分后第三位去尾，分后第二位进位 |
| 规则C/D/E | 所有卡类型 | 进位 | 与规则A计算方式相同 |
| 规则F/G | 支付宝二维码主扫 | 去尾+四舍五入 | 去尾保留三位，然后四舍五入 |

#### 止付扣款及分润规则

| 计费规则 | 止付类型 | 扣款规则 | 分润规则 |
|---------|---------|---------|---------|
| A/B/C/D/E | 服务费 | 手续费不扣除；服务费按报备金额全额扣除 | 手续费不分润；服务费返现按政策金额 |
| A/B/C/D/E | 通讯服务费 | 手续费正常计算；通讯服务费：交易金额-手续费>=通讯服务费时扣除 | 手续费正常分润；通讯服务费按政策返现 |

---

### 3.3 代付出款通知 (PAYMENT_ORDER_NOTIFY)

**serviceType**: `PAYMENT_ORDER_NOTIFY`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 代付申请时间 | createTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 代付成功时间 | successTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 代付订单编号 | orderNo | String | M | |
| 提现金额 | amount | BigDecimal | M | 单位:元 保留小数点两位 |
| 提现总手续费 | withdrawFeeTotal | BigDecimal | M | 单位:元 (提现税费+单笔提现手续费) |
| 单笔提现手续费 | withdrawFee | BigDecimal | M | 单位:元 保留小数点两位 |
| 提现税率 | taxRate | BigDecimal | M | 单位:元 保留小数点两位 |
| 提现税费 | withdrawTaxFee | BigDecimal | M | 单位:元 保留小数点两位 |
| 账户扣款金额 | deductionAmount | BigDecimal | M | 账户扣款金额=提现金额+提现总手续费 |
| 结算账户 | accountNo | String | M | 脱敏格式 |
| 结算账户名称 | accountName | String | M | 脱敏格式 |
| 结算账户银行名称 | bankName | String | M | |
| 结算账户支行名称 | branchName | String | M | |
| 结算手机号 | phoneNo | String | M | 脱敏格式 |
| 结算方式 | settleType | String | M | 参考字典: 3.4 结算方式 |
| 结算账户支行编码 | unionCode | String | O | |
| 代付出款状态 | status | String | M | 参考字典: 3.8 代付出款状态 |
| 代付失败原因 | failReason | String | O | |

---

### 3.4 终端状态通知 (MATERIAL_BIND_STATUS_NOTIFY)

**serviceType**: `MATERIAL_BIND_STATUS_NOTIFY`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 代理编号 | agentNo | String | M | |
| 商户编号 | customerNo | String | M | |
| 旧设备tusn | oldMaterialsNo | String | C | 状态:CHANGE_BIND 换绑成功返回 |
| 设备tusn | materialsNo | String | M | |
| 终端绑定状态 | bindStatus | String | M | TRUE 解绑成功; BINDED 绑定成功; CHANGE_BIND 换绑成功; FORCED_UNBIND 强制解绑成功 |
| 终端变更时间 | changeTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |

---

### 3.5 商户信息通知 (CUSTOMER_INFO_REGISTER_NOTIFY)

**serviceType**: `CUSTOMER_INFO_REGISTER_NOTIFY`

商户入网成功后接收商户信息。

#### 请求参数（主结构）

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户基本信息 | customerInfoNotify | Object | M | 具体参数见下表 |
| 商户结算信息 | customerSettleCardNotify | Object | O | 具体参数见下表 |
| 商户费率信息 | rateNotifyList | List | O | 具体参数见下表 |

#### 商户基本信息

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 代理商编号 | agentNo | String | M | |
| 商户创建时间 | createTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 商户类型 | customerType | String | M | 参考字典: 3.13 商户类型 |
| 商户编号 | customerNo | String | M | |
| 商户名称 | customerName | String | M | |
| 证件类型 | idType | String | M | 类型: ID身份证 |
| 身份证姓名 | idCardName | String | M | 脱敏格式 |
| 身份证号 | idCardNo | String | M | 脱敏格式 |
| 身份证有效期-开始时间 | idCardEffectiveBegin | String | M | 日期格式: yyyy-MM-dd |
| 身份证有效期-结束时间 | idCardEffectiveEnd | String | M | 日期格式: yyyy-MM-dd (长期 9999-12-31) |
| 经营类目 | category | String | M | |
| 经营类目名称 | categoryName | String | M | |
| 商户地区编码 | unionOrgCode | String | M | |
| 商户注册地址 | registerAddress | String | M | |
| 商户经营名称 | bussinessName | String | M | |
| 商户状态 | status | String | M | 状态: TRUE 可用 |
| 手机号 | phoneNo | String | C | 脱敏格式 |

#### 商户结算信息

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 结算账户类型 | accountType | String | M | 类型 TO_PRIVATE:对私 |
| 结算账户名称 | accountName | String | M | 脱敏格式 |
| 结算账户 | accountNo | String | M | 脱敏格式 |
| 结算账户手机号 | phoneNo | String | M | 脱敏格式 |
| 结算账户类型 | cardType | String | O | 类型: DC 借记卡 CC 贷记卡 |
| 结算账户银行编码 | bankCode | String | O | |
| 结算账户银行名称 | bankName | String | O | |
| 结算账户支行名称 | branchName | String | O | |
| 结算账户支行编码 | unionCode | String | O | |

#### 商户费率信息

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率类型 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 费率值 | rateValue | BigDecimal | M | 百分比类型 示例: 0.3% 值为0.3 |
| 附加费 | fixedValue | BigDecimal | M | 固定值金额; 单位:元 |
| 封顶值 | cappingValue | BigDecimal | M | 借记卡封顶值; 单位:元 |
| 费率版本号 | rateVersion | String | M | 用于交易通知进行费率校验 |

---

### 3.6 终端激活通知 (MATERIALS_ACTIVATION_NOTIFY)

**serviceType**: `MATERIALS_ACTIVATION_NOTIFY`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 商户名称 | customerName | String | M | |
| 设备tusn | materialsNo | String | M | |
| 终端类型 | materialsType | String | M | 参考字典: 3.12 终端类型 |
| 激活时间 | activationTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 激活状态 | activationStatus | String | M | 状态: FINISHED已完成 |

---

### 3.7 商户费率通知 (CUSTOMER_LAST_RATE_NOTIFY)

**serviceType**: `CUSTOMER_LAST_RATE_NOTIFY`

触发场景：
- 商户首次绑定终端
- 通过接口修改商户费率
- 展业APP修改商户费率

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 商户费率信息 | rateNotifyList | List | M | 具体参数见下表 |

#### 商户费率信息详情

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率类型 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 费率(基础) | rateValue | BigDecimal | M | 百分比类型 示例: 0.3% 值为0.3 |
| 附加费(基础) | fixedValue | BigDecimal | M | 固定值金额; 单位:元 |
| 封顶值 | cappingValue | BigDecimal | M | 借记卡封顶值; 单位:元 |
| 费率版本号 | rateVersion | String | M | 用于交易通知进行费率校验 |
| 平台服务费信息 | serviceFeeList | List | O | 具体参数见下表 |
| 生效时间开始时间 | effectiveBegin | Date | M | 同时多次通知时,获取生效时间最新费率 |

#### 平台服务费信息

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率类型 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 业务类型 | businessType | String | M | |
| 平台服务费费率 | raiseRate | BigDecimal | O | |
| 平台服务费固定金额 | raiseFixedValue | BigDecimal | O | |

---

### 3.8 代付出款通知(新) (PAYMENT_ORDER_NOTIFY_V2)

**serviceType**: `PAYMENT_ORDER_NOTIFY_V2`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 提现订单编号 | orderNo | String | M | |
| 提现状态 | status | String | M | 参考字典: 3.8 代付出款状态 |
| 提现金额 | amount | BigDecimal | M | 提现过税金额（非到账金额） |
| 提现总手续费 | withdrawFeeTotal | BigDecimal | C | (提现税费(税额)+提现税费(个税)+单笔提现手续费) |
| 单笔提现手续费 | withdrawFee | BigDecimal | M | 单位:元 |
| 提现税率 | taxRate | BigDecimal | M | |
| 提现税费(税额) | withdrawTaxFee1 | BigDecimal | C | |
| 提现税费(个税) | withdrawTaxFee2 | BigDecimal | C | |
| 结算到账金额 | settleAmount | BigDecimal | C | =提现金额-提现单笔手续费-提现税费(税额)-提现税费(个税) |
| 提现时间 | createTime | String | M | 日期格式: yyyy-MM-dd HH:mm:ss |
| 提现成功时间 | successTime | String | C | |
| 结算方式 | settleType | String | M | 参考字典: 3.4 结算方式 |
| 结算账户 | accountNo | String | M | 脱敏格式 |
| 结算账户名称 | accountName | String | M | 脱敏格式 |
| 结算银行名称 | bankName | String | M | |
| 结算账户支行名称 | branchName | String | C | |
| 结算账户支行编码 | unionCode | String | C | |
| 结算账户手机号 | phoneNo | String | O | 脱敏格式 |
| 结算账户身份证号 | idCard | String | O | 脱敏格式 |
| 账户类型 | accountType | String | M | 参考字典: 3.1 账户类型 |
| 失败原因 | failReason | String | C | |

---

### 3.9 切换银联信息通知 (CUSTOMER_UNION_CHANGE_NOTIFY)

**serviceType**: `CUSTOMER_UNION_CHANGE_NOTIFY`

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 状态 | status | String | C | TRUE-成功; DONE_NOTHING-解绑失败; UNBIND-解绑成功,绑定失败 |
| 备注信息 | remark | String | C | |

---

## 4. 商户类接口

### 4.1 终端绑定 (/bindMaterials)

| 项目 | 说明 |
|------|------|
| 接口地址 | /bindMaterials |
| 接口说明 | 商户终端绑定 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 设备tusn | materialsNo | String | M | |

#### 响应参数

| 中文域名 | 响应参数 | 必选 | 说明 |
|---------|---------|-----|------|
| 返回码 | code | M | 00-通知成功 |
| 返回信息 | msg | M | 失败原因 |
| 数据 | data | O | |

---

### 4.2 终端解绑 (/unBindMaterials)

| 项目 | 说明 |
|------|------|
| 接口地址 | /unBindMaterials |
| 接口说明 | 商户终端解绑（有成功交易的终端无法使用接口解绑） |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 设备tusn | materialsNo | String | M | |

#### 响应码说明

| code | msg | 示例 |
|------|-----|------|
| 00 | 成功 | |
| 98 | 失败，具体看响应描述 | |
| 1101 | 代理商编号{代理编号}对应的设备编号{设备tusn}信息不存在 | 代理商编号90001对应的设备编号0000test00004信息不存在 |
| 1102 | 设备编号{设备tusn}未绑定商户{商户编号}信息不存在 | 设备编号90001未绑定商户827814162955632信息不存在 |

---

### 4.3 终端修改默认费率 (/batchSetDefaultRate)

| 项目 | 说明 |
|------|------|
| 接口地址 | /batchSetDefaultRate |
| 接口说明 | 终端修改默认费率 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 设备tusn | materialsNoList | List<String> | M | 设备tusn列表 |
| 默认费率 | materialsDefaultRateList | List<Object> | M | 费率列表 |

#### 默认费率具体参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率编码 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 费率值 | rateValue | BigDecimal | M | 百分比类型 示例: 0.3% 传值为0.3 |
| 附加费 | fixedValue | BigDecimal | M | 固定值金额; 单位:元 |
| 封顶值 | cappingValue | BigDecimal | M | 借记卡封顶值; 单位:元 |

#### 响应参数

| 中文域名 | 响应参数 | 必选 | 说明 |
|---------|---------|-----|------|
| 返回码 | code | M | 00-通知成功 |
| 返回信息 | msg | M | 失败原因 |
| 数据 | data | M | 类型String 值为费率版本号 |

---

### 4.4 商户修改费率 (/customerRateModify)

| 项目 | 说明 |
|------|------|
| 接口地址 | /customerRateModify |
| 接口说明 | 商户修改费率（修改时需要传全部的费率类型） |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |
| 商户费率信息 | customerRateList | List<Object> | M | |

#### 费率具体参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率编码 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 费率值 | rateValue | BigDecimal | M | 百分比类型 |
| 附加费 | fixedValue | BigDecimal | M | 单位:元 |
| 封顶值 | cappingValue | BigDecimal | M | 单位:元 |

---

### 4.5 商户费率查询 (/customerRateQuery)

| 项目 | 说明 |
|------|------|
| 接口地址 | /customerRateQuery |
| 接口说明 | 查询商户费率 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |

#### 响应data内容

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 费率类型 | payTypeViewCode | String | M | 参考字典: 3.6 费率类型 |
| 费率(基础) | rateValue | BigDecimal | M | 百分比类型 |
| 附加费(基础) | fixedValue | BigDecimal | M | 单位:元 |
| 封顶值 | cappingValue | BigDecimal | M | 单位:元 |
| 费率版本号 | rateVersion | String | M | |
| 平台服务费信息 | serviceFeeList | List | O | |

---

### 4.6 终端查询 (/materialsDataQuery)

| 项目 | 说明 |
|------|------|
| 接口地址 | /materialsDataQuery |
| 接口说明 | 终端信息查询 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 设备tusn | materialsNo | String | M | |

#### 响应data内容

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 政策ID | policyId | Long | |
| 终端类型 | materialsType | String | |
| 厂商信息 | factoryInfo | String | |
| 终端型号 | materialsModel | String | |
| 设备tusn | materialsNo | String | |
| 终端费率 | materialsRateList | List<Object> | 终端费率信息；绑定之后不返回 |
| 终端服务费信息 | materialsMachineInfo | Object | |
| 终端通讯服务费信息 | materialsSimInfo | Object | |

#### 终端费率信息

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 支付类型编码 | payTypeCode | String | 参考字典: 3.6 费率类型 |
| 费率(百分比) | rateValue | BigDecimal | 百分比类型 |
| 固定值费率(单位:元) | fixedValue | BigDecimal | |
| 封顶值(单位:元) | cappingValue | BigDecimal | |
| 费率版本号 | rateVersion | String | |

#### 终端服务费信息

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 服务费扣款状态 | machineDeductionStatus | String | YES: 已扣款 NO: 未扣款 |
| 服务费档位列表 | materialsMachineList | List<Object> | |

#### 服务费档位列表

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 档位序列 | machinePhaseIndex | Integer | |
| 服务费金额 | machineAmount | BigDecimal | 单位：元 |
| 启用状态 | enableStatus | String | YES: 启用 NO: 未启用 |

#### 终端通讯服务费信息

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 免费天数 | simFreeDay | Integer | |
| 日期计算方式 | dateComputeType | String | |
| 通讯服务费详情 | simPhaseList | List<Object> | |

#### 多档位通讯服务费详情

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 通讯服务费阶段 | simRuleIndex | Integer | |
| 开始天数 | beginDayNum | Integer | |
| 结束天数 | endDayNum | Integer | |
| 扣款状态 | deductionStatus | String | YES: 已扣款 NO: 未扣款 |
| 开始天数区间最小值 | beginDayMinRang | Integer | 修改通讯服务费扣费天数,需要在最大最小值范围内 |
| 开始天数区间最大值 | beginDayMaxRang | Integer | |
| 通讯服务费扣费详情 | simDeductionsList | List<Object> | |

#### 通讯服务费扣费详情

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 扣费金额 | deductionAmount | BigDecimal | 单位：元 |
| 档位序列 | simPhaseIndex | Integer | |
| 启用状态 | enableStatus | String | YES: 启用 NO: 未启用 |

---

### 4.7 服务费设置 (/machineFeeChange)

| 项目 | 说明 |
|------|------|
| 接口地址 | /machineFeeChange |
| 接口说明 | 终端未绑定商户时，设置服务费档位 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 设备tusn | materialsNo | String | M | |
| 档位序列 | machinePhaseIndex | Integer | M | 对应终端查询接口服务费档列表的machinePhaseIndex参数 |

---

### 4.8 通讯服务费设置 (/simFeeChange)

| 项目 | 说明 |
|------|------|
| 接口地址 | /simFeeChange |
| 接口说明 | 通讯服务费变更（已收取阶段不允许变更档位） |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 设备tusn | materialsNo | String | M | |
| 通讯服务费扣款 | simDeductionsList | List<Object> | M | |

#### 通讯服务费扣款详情

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 通讯服务费阶段 | simRuleIndex | Integer | 对应终端查询接口多档位通讯服务费详情列表的simRuleIndex参数 |
| 通讯服务费档位 | simPhaseIndex | Integer | 对应终端查询接口通讯服务费扣费详情列表的simPhaseIndex参数 |
| 通讯服务费扣费起始天数 | beginDayNum | Integer | 通讯服务费扣费天数 |

---

### 4.9 再报备商户 (/rushRegisterCust)

| 项目 | 说明 |
|------|------|
| 接口地址 | /rushRegisterCust |
| 接口说明 | 再报备商户 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 商户编号 | customerNo | String | M | |

#### 响应data内容

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 状态 | status | String | SUCCESS表示银联商户报备成功 |
| 原因 | reason | String | |

---

## 5. 代付类接口

### 5.1 查询账户余额 (/accountBalanceQuery)

| 项目 | 说明 |
|------|------|
| 接口地址 | /accountBalanceQuery |
| 接口说明 | 查询各个账户余额 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 账户类型 | accountType | String | O | 参考字典: 3.1 账户类型 |

#### 响应data内容

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 账户编号 | accountNo | String | 脱敏格式 |
| 账户类型 | accountType | String | 参考字典: 3.1 账户类型 |
| 账户状态 | status | String | 参考字典: 3.3 账户状态 |
| 总余额 | balance | BigDecimal | 单位:元（包含在途金额、冻结金额） |
| 在途金额 | transitBalance | BigDecimal | 单位:元 |
| 冻结金额 | freezeBalance | BigDecimal | 单位:元 |
| 可用金额 | availableBalance | BigDecimal | 可用余额=总余额-在途金额-冻结金额 |
| 累计收入金额 | incomeBalance | BigDecimal | 单位:元 |
| 累计支出金额 | spendBalance | BigDecimal | 单位:元 |

---

### 5.2 代付申请(新) (/submitWithdraw/v2)

| 项目 | 说明 |
|------|------|
| 接口地址 | /submitWithdraw/v2 |
| 接口说明 | 发起代付提现申请，金额以"元"为单位，手续费内扣 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 最大长度 | 说明 |
|---------|---------|---------|-----|---------|------|
| 提现订单编号 | orderNo | String | M | 32 | 保证唯一 |
| 账户类型 | accountType | String | M | 32 | 参考字典: 3.1 账户类型 |
| 结算方式 | settleType | String | M | 32 | 参考字典: 3.4 结算方式 |
| 结算账户 | accountNo | String | M | 64 | |
| 结算账户名称 | accountName | String | M | 64 | |
| 结算银行总行名称 | bankName | String | M | 64 | |
| 结算账户支行名称 | branchName | String | C | 64 | 对公结算必填 |
| 结算账户支行编码 | unionCode | String | C | 32 | 对公结算必填 |
| 结算账户手机号 | phoneNo | String | O | 16 | 对私结算必填 |
| 结算账户身份证号 | idCard | String | O | 32 | 对私结算必填 |
| 提现金额 | amount | BigDecimal | M | 11 | 单位:元（非到账金额） |

---

### 5.3 代付查询(新) (/withdrawResultQuery/v2)

| 项目 | 说明 |
|------|------|
| 接口地址 | /withdrawResultQuery/v2 |
| 接口说明 | 查询代付提现状态及信息 |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 提现订单编号 | orderNo | String | M | |

#### 响应data内容

与"代付出款通知(新)"参数一致。

---

### 5.4 图片上传 (/uploadFile)

| 项目 | 说明 |
|------|------|
| 接口地址 | /uploadFile |
| 接口说明 | 图片上传，请求格式为form-data |
| 请求方式 | POST |

#### 请求参数

| 中文域名 | 请求参数 | 参数类型 | 请求 | 说明 |
|---------|---------|---------|-----|------|
| 业务类型 | businessType | String | M | AGENT代理 CUSTOMER商户 |
| 文件 | file | File | M | 二进制文件(不参与加密签名) |
| 图片类型 | imgType | String | M | 参考字典: 3.2 图片类型 |

#### 响应data内容

| 中文域名 | 请求参数 | 参数类型 | 说明 |
|---------|---------|---------|------|
| 响应流水号 | responseId | String | |
| 图片ID | imgId | String | |

---

## 6. 字典说明

### 6.1 账户类型

| 参数值 | 参数说明 |
|--------|---------|
| SHARE | 分润钱包 |
| ACTIVITY_SUBSIDY | 服务费返现钱包 |
| SIM_CARD | 通讯服务费钱包 |
| COMMISSION | 分成返现钱包 |
| ACTIVITY_CASHBACK | 活动返现钱包 |
| ACTIVITY_RECHARGE | 充值账户（可选） |

### 6.2 图片类型

| 参数值 | 参数说明 |
|--------|---------|
| BUSSINESS_LICENSE | 营业执照 |
| LEGAL_PERSON_ID_POSITIVE | 法人身份证人像面 |
| LEGAL_PERSON_ID_BACK | 法人身份证国徽面 |
| SETTLE_CARD_IMG | 结算账户图片 |
| ACCOUNT_OPENING_LICENSE | 开户许可证 |

### 6.3 账户状态

| 参数值 | 参数说明 |
|--------|---------|
| NORMAL | 正常 |
| FREEZE | 冻结 |

### 6.4 结算方式

| 参数值 | 参数说明 |
|--------|---------|
| TO_PUBLIC | 企业-对公结算 |
| TO_PUBLIC_UNINCORPORATED | 企业-对私结算 |
| TO_PRIVATE | 个人-法人结算 |

### 6.5 提现状态

| 参数值 | 参数说明 |
|--------|---------|
| INIT | 待提交 |
| WAIT_AUDIT | 待审核 |
| WAIT_PAY | 出款中 |
| SUCCESS | 成功 |
| FAIL | 失败 |
| REJECT | 拒绝 |

### 6.6 费率类型

| 参数值 | 参数说明 |
|--------|---------|
| WECHAT | 微信 |
| ALIPAY | 支付宝 |
| POS_DC | 普通刷卡-借记 |
| POS_CC | 普通刷卡-贷记 |
| POS_DISCOUNT_CC | 特惠 |
| POS_DISCOUNT_GF_CC | 特惠GF |
| POS_DISCOUNT_PA_CC | 特惠PA |
| POS_DISCOUNT_MS_CC | 特惠MS |
| UNIONPAY_DOWN_CC | 云闪付1000- |

### 6.7 止付类型

| 参数值 | 参数说明 |
|--------|---------|
| MACHINE | 服务费 |
| SIM | 通讯服务费 |

### 6.8 代付出款状态

| 参数值 | 参数说明 |
|--------|---------|
| INIT | 待出款 |
| WAIT_PAY | 出款中 |
| SUCCESS | 成功 |
| FAIL | 失败 |

### 6.9 支付类型

| 参数值 | 参数说明 |
|--------|---------|
| Card | 银行卡 |
| UnionQr | 银联二维码 |
| Wechat | 微信 |
| AliPay | 支付宝 |
| MobilePay | 手机Pay |
| QuickPass | 闪付 |

### 6.10 支付类型明细

| 参数值 | 参数说明 |
|--------|---------|
| WECHAT | 微信 |
| ALIPAY | 支付宝 |
| POS_DC | 普通刷卡-借记 |
| POS_CC | 普通刷卡-贷记 |
| POS_DISCOUNT_CC | 特惠 |
| POS_DISCOUNT_GF_CC | 特惠-GF |
| POS_DISCOUNT_MS_CC | 特惠-MS |
| POS_DISCOUNT_PA_CC | 特惠-PA |
| UNIONPAY_DOWN_CC | 云闪付1000-贷记 |
| UNIONPAY_DOWN_DC | 云闪付1000-借记 |
| UNIONPAY_UP_CC | 云闪付1000+贷记 |
| UNIONPAY_UP_DC | 云闪付1000+借记 |

### 6.11 订单状态

| 参数值 | 参数说明 |
|--------|---------|
| SUCCESS | 成功 |
| FAIL | 失败 |

### 6.12 终端类型

| 参数值 | 参数说明 |
|--------|---------|
| DQPOS | 电签终端 |
| POS | 传统终端 |

### 6.13 商户类型

| 参数值 | 参数说明 |
|--------|---------|
| SMALL | 小微 |

### 6.14 支付类型与支付类型明细映射关系

| 支付类型 | 支付类型明细 |
|---------|-------------|
| 手机pay1000(含)以下 (MobilePay) | UNIONPAY_DOWN_CC、UNIONPAY_DOWN_DC |
| 银联二维码1000(含)以下 (UnionQr) | UNIONPAY_DOWN_CC、UNIONPAY_DOWN_DC |
| 闪付 (QuickPass) | POS_DC、POS_CC、POS_DISCOUNT_CC、POS_DISCOUNT_GF_CC、POS_DISCOUNT_MS_CC、POS_DISCOUNT_PA_CC |
| 手机pay1000以上 (MobilePay) | POS_DC、POS_CC |
| 银联二维码1000以上 (UnionQr) | UNIONPAY_UP_DC、UNIONPAY_UP_CC |
| 刷卡 (Card) | POS_DC、POS_CC、POS_DISCOUNT_CC、POS_DISCOUNT_GF_CC、POS_DISCOUNT_MS_CC、POS_DISCOUNT_PA_CC |
| 微信 (Wechat) | WECHAT |
| 支付宝 (AliPay) | ALIPAY |

---

## 7. 与恒信通对比

| 对比项 | 联动支付 | 恒信通 |
|--------|---------|--------|
| 通道编码 | LIANDONG | HENGXINTONG |
| 加密方式 | RSA+AES混合加密 | RSA签名验证 |
| 签名算法 | SHA256WithRSA | SHA256WithRSA |
| 通知响应 | 返回 `OK` | 返回 `{"code":0}` |
| 回调区分字段 | serviceType | action |
| 交易通知 | PAY_ORDER_NOTIFY | pos_order |
| 终端绑定通知 | MATERIAL_BIND_STATUS_NOTIFY | sn_bind |
| 商户入网通知 | CUSTOMER_INFO_REGISTER_NOTIFY | merc_income |
| 费率变更通知 | CUSTOMER_LAST_RATE_NOTIFY | merc_rate_update |
| 流量费通知 | 止付类型字段(stopPayType=SIM) | sn_device_fee |
| 金额单位 | 元 | 分 |

---

## 8. 适配器实现要点

### 8.1 需要实现的回调类型

| serviceType | 回调类型 | 优先级 | 对应统一类型 |
|-------------|---------|--------|-------------|
| PAY_ORDER_NOTIFY | 交易订单通知 | 高 | pos_order |
| MATERIAL_BIND_STATUS_NOTIFY | 终端状态通知 | 高 | sn_bind |
| CUSTOMER_INFO_REGISTER_NOTIFY | 商户信息通知 | 中 | merc_income |
| CUSTOMER_LAST_RATE_NOTIFY | 商户费率通知 | 中 | merc_rate_update |
| MATERIALS_ACTIVATION_NOTIFY | 终端激活通知 | 中 | - |
| PAYMENT_ORDER_NOTIFY_V2 | 代付出款通知 | 低 | - |

### 8.2 关键字段映射（交易回调）

| 联动字段 | 统一字段 | 说明 |
|---------|---------|------|
| orderNo | order_no | 订单号 |
| materialsNo | terminal_no | 终端号(tusn) |
| customerNo | merchant_no | 商户号 |
| agentNo | agent_id | 代理商ID |
| successTime | trans_time | 交易时间 |
| amount | amount | 金额(元→分，需*100) |
| payTypeCode | card_type | 支付类型明细 |
| feeRate | fee_rate | 费率 |
| fee | fee | 手续费(元→分) |
| status | status | 订单状态 |
| stopPayType | - | 止付类型(服务费/通讯费) |
| stopPayAmount | - | 止付金额 |

### 8.3 签名验证流程

```go
func (a *LiandongAdapter) VerifySign(rawBody []byte) (bool, error) {
    // 1. 解析JSON获取sign字段
    // 2. 移除sign字段，按字典序排列其他字段
    // 3. 拼接成 key1=value1&key2=value2 格式
    // 4. 使用平台公钥 + SHA256WithRSA 验签
    return verified, nil
}
```

### 8.4 数据解密流程

```go
func (a *LiandongAdapter) DecryptData(encryptKey, data string) ([]byte, error) {
    // 1. 用私钥RSA解密encryptKey，得到aesKey(16位)
    // 2. 用aesKey AES/ECB/PKCS5Padding解密data
    return decryptedData, nil
}
```

### 8.5 响应格式

```go
func (a *LiandongAdapter) BuildResponse(success bool) string {
    if success {
        return "OK"  // 联动要求返回OK字符串
    }
    return "FAIL"
}
```

### 8.6 金额转换注意

```go
// 联动金额单位是"元"，系统内部统一用"分"
func yuanToFen(yuan float64) int64 {
    return int64(yuan * 100)
}
```
